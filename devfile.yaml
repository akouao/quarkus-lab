apiVersion: 1.0.0
metadata:
  name: quarkus-lab
projects:
  - name: quarkus-lab
    source:
      location: 'https://github.com/akouao/quarkus-lab.git'
      type: git
components:
  - id: redhat/quarkus-java11/latest
    type: chePlugin
  - mountSources: true
    endpoints:
      - name: web-development
        port: 8080
    memoryLimit: 4Gi
    type: dockerimage
    alias: quarkus-tools
    image: quay.io/openshiftlabs/quarkus-workshop-stack@sha256:2c74400f3b54650d5e054ea005d5873dd3491ec2d03f6357271ce91530ece73a
    env:
      - value: /home/jboss/.m2
        name: MAVEN_CONFIG
      - value: >-
          -Xmx4G -Xss128M -XX:MetaspaceSize=1G -XX:MaxMetaspaceSize=2G
          -XX:+CMSClassUnloadingEnabled
        name: MAVEN_OPTS
commands:
  - name: Start Live Coding
    actions:
      - workdir: '${CHE_PROJECTS_ROOT}'
        type: exec
        command: >-
          mvn clean compile quarkus:dev -f
          ${CHE_PROJECTS_ROOT}/quarkus-lab/getting-started
        component: quarkus-tools
  - name: Package Application
    actions:
      - workdir: '${CHE_PROJECTS_ROOT}'
        type: exec
        command: >-
          mvn package -DuberJar=true -DskipTests -f
          ${CHE_PROJECTS_ROOT}/quarkus-lab/getting-started
        component: quarkus-tools
  - name: Build Native App
    actions:
      - workdir: '${CHE_PROJECTS_ROOT}'
        type: exec
        command: >-
          mvn package -Pnative -DskipTests -f
          ${CHE_PROJECTS_ROOT}/quarkus-lab/getting-started
        component: quarkus-tools
